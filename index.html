<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <!-- 适配红米K70至尊版：6.67英寸、2712×1220分辨率 -->
        <meta name="viewport" content="width=device-width, initial-scale=0.95, maximum-scale=0.95, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">

        <title>空运成本计算器（分泡版）</title>

        <style>
            * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation; /* 优化安卓触控延迟 */
            }
            body {
            font-family: 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            width: 100%;
            min-height: 100vh;
            padding: 20px 15px; /* 上下padding增加，适配6.67英寸 */
            background-color: #f5f5f5;
            font-size: 16px; /* 基准字体放大，适配高分辨率 */
            }
            h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 2px solid #3498db;
            font-size: 20px; /* 标题放大 */
            font-weight: bold;
            }
            .calculator {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px; /* 内边距放大 */
            margin-bottom: 25px;
            }
            /* 物流工具按钮（6.67英寸适配） */
            .tool-button {
            display: inline-block;
            padding: 12px 18px; /* 按钮内边距放大 */
            background: #0066cc;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin: 6px;
            font-size: 16px; /* 文字放大 */
            width: calc(50% - 12px); /* 调整宽度，适配屏幕 */
            text-align: center;
            }
            /* 智能识别输入框样式（小巧紧凑版） */
            .smart-input-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.08);
            padding: 12px 15px; /* 大幅缩小内边距 */
            margin: 15px 0 20px 0; /* 调整上下间距 */
            }
            .smart-input-title {
            font-weight: bold;
            color: #16a085;
            margin: 0 0 8px 0; /* 缩小标题间距 */
            font-size: 16px; /* 缩小标题字体 */
            line-height: 1; /* 紧凑行高 */
            }
            .smart-input-box {
            width: 100%;
            padding: 8px 10px; /* 缩小输入框内边距 */
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px; /* 缩小输入框字体 */
            height: 40px; /* 降低输入框高度 */
            background-color: #fafafa;
            margin-bottom: 8px; /* 缩小输入框和按钮间距 */
            }
            .parse-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 10px; /* 缩小按钮内边距 */
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px; /* 缩小按钮字体 */
            width: 100%;
            height: 40px; /* 降低按钮高度 */
            font-weight: bold;
            line-height: 1; /* 紧凑行高 */
            }
            .parse-btn:hover {
            background-color: #27ae60;
            }
            /* 表格（适配高分辨率） */
            table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 16px; /* 表格文字放大 */
            }
            th, td {
            border: 1px solid #ddd;
            padding: 10px 8px; /* 单元格内边距放大 */
            text-align: left;
            }
            /* 输入框（适配红米K70触控） */
            input {
            width: 100%;
            padding: 12px; /* 输入框内边距放大 */
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px; /* 输入文字放大 */
            height: 48px; /* 输入框高度放大，适配手指点击 */
            background-color: #fafafa;
            }
            input::placeholder {
            font-size: 15px; /* 提示文字放大 */
            color: #999;
            }
            .result {
            font-weight: bold;
            color: #2980b9;
            background-color: #f8f9fa;
            text-align: center;
            font-size: 16px; /* 结果文字放大 */
            padding: 12px 0; /* 结果单元格内边距 */
            }
            /* 计费标准+分泡比例（6.67英寸适配） */
            .billing-bubble-container {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            width: 100%;
            flex-wrap: wrap;
            }
            .billing-section, .bubble-section {
            flex: 1;
            min-width: 160px; /* 最小宽度放大 */
            }
            .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 8px;
            }
            .option-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 12px; /* 单选框标签内边距放大 */
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px; /* 单选框文字放大 */
            background-color: white;
            }
            .option-group input[type="radio"] {
            width: 20px; /* 单选框大小放大 */
            height: 20px;
            margin: 0;
            padding: 0;
            }
            /* 计算按钮（红米K70适配，放大点击区域） */
            button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 18px; /* 按钮内边距大幅放大 */
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px; /* 按钮文字放大 */
            margin-top: 15px;
            width: 100%;
            font-weight: bold;
            height: 60px; /* 按钮高度放大，适配单手点击 */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            }
            button:hover {
            background-color: #2980b9;
            }
            .section-title {
            font-weight: bold;
            color: #16a085;
            margin: 15px 0 10px 0;
            font-size: 18px; /* 区域标题放大 */
            }
            .hidden {
            display: none !important;
            }
        </style>
    </head>
    <body>
        <h1>空运成本计算器（分泡版）</h1>

        <a href="https://www.track-trace.com/" target="_blank" class="tool-button">
            物流跟踪查询
        </a>
        <a href="https://misaka0502ab.github.io/cargodata/" target="_blank" class="tool-button">
            数据转换器
        </a>
        <a href="https://map.baidu.com" target="_blank" class="tool-button">
            百度地图
        </a>
        <a href="https://www.bing.com/maps" target="_blank" class="tool-button">
            Bing地图
        </a>

        <!-- 智能识别输入区域 -->
        <div class="smart-input-section">
            <div class="smart-input-title">智能识别重量体积</div>
            <input type="text" class="smart-input-box" id="smartInput" placeholder="示例：1pcs / 250.0kgs / 0.75cbm">
            <button class="parse-btn" onclick="parseSmartInput()">提取数据</button>
        </div>

        <div class="calculator">
            <div class="section-title">基础参数</div>
            <table>
                <tr>
                    <td>体积 (m³)</td>
                    <td><input type="number" id="volume" step="0.001" placeholder="输入体积"></td>
                    <td>C.W.</td>
                    <td class="result" id="cw">-</td>
                </tr>
                <tr>
                    <td>G.W. (kg)</td>
                    <td><input type="number" id="gw" step="0.001" placeholder="输入实际重量"></td>
                    <td>比例</td>
                    <td class="result" id="ratio">-</td>
                </tr>
                <tr>
                    <td>USD/RMB汇率</td>
                    <td><input type="number" id="exchangeRate" step="0.0001" value="6.95" placeholder="输入汇率"></td>
                    <td>成本计费重</td>
                    <td class="result" id="costWeight">-</td>
                </tr>
            </table>

            <div class="section-title">成本计算</div>
            <table>
                <tr>
                    <td>成本RMB/KG</td>
                    <td><input type="number" id="rmbPerKg" step="0.01" placeholder="输入RMB单价"></td>
                    <td>分泡后RMB/KG</td>
                    <td class="result" id="rmbAfter">-</td>
                </tr>
                <tr>
                    <td>成本USD/KG</td>
                    <td class="result" id="usdPerKg">-</td>
                    <td>分泡后USD/KG</td>
                    <td class="result" id="usdAfter">-</td>
                </tr>
            </table>

            <div class="section-title">总成本</div>
            <table>
                <tr>
                    <td colspan="2"></td>
                    <td>空运总成本RMB</td>
                    <td class="result" id="totalRMB">-</td>
                </tr>
                <tr>
                    <td colspan="2"></td>
                    <td>空运总成本USD</td>
                    <td class="result" id="totalUSD">-</td>
                </tr>
            </table>

            <div class="billing-bubble-container">
                <div class="billing-section">
                    <div class="section-title">计费标准</div>
                    <div class="option-group">
                        <label>
                            <input type="radio" name="billing" value="0.006" checked>
                            <span>大陆 (167)</span>
                        </label>
                        <label>
                            <input type="radio" name="billing" value="0.007">
                            <span>香港 (143)</span>
                        </label>
                    </div>
                </div>
                <div class="bubble-section">
                    <div class="section-title">分泡比例</div>
                    <div class="option-group" id="mainlandBubble">
                        <label>
                            <input type="radio" name="bubble" value="0.5" checked>
                            <span>55分</span>
                        </label>
                        <label>
                            <input type="radio" name="bubble" value="0.4">
                            <span>46分</span>
                        </label>
                        <label>
                            <input type="radio" name="bubble" value="0.3">
                            <span>37分</span>
                        </label>
                        <label>
                            <input type="radio" name="bubble" value="0.2">
                            <span>28分</span>
                        </label>
                    </div>
                    <div class="option-group hidden" id="hongkongBubble">
                        <label>
                            <input type="radio" name="bubbleHk" value="0.3333" checked>
                            <span>1/3</span>
                        </label>
                        <label>
                            <input type="radio" name="bubbleHk" value="0.6667">
                            <span>2/3</span>
                        </label>
                    </div>
                </div>
            </div>

            <button onclick="calculate()">计算所有结果</button>
        </div>

        <script>
            // 智能识别解析函数
            function parseSmartInput() {
                try {
                    const inputText = document.getElementById('smartInput').value.trim();
                    if (!inputText) {
                        alert("请输入需要识别的文本！");
                        return;
                    }

                    // 正则提取重量（匹配xxx.xxkgs/kg/千克/公斤）
                    const weightRegex = /(\d+\.?\d*)\s*(?:kgs?|千克|公斤)/i;
                    const weightMatch = inputText.match(weightRegex);
                    const weight = weightMatch ? parseFloat(weightMatch[1]) : null;

                    // 正则提取体积（匹配xxx.xxcbm/立方米/m³/m3）
                    const volumeRegex = /(\d+\.?\d*)\s*(?:cbm|立方米|m³|m3)/i;
                    const volumeMatch = inputText.match(volumeRegex);
                    const volume = volumeMatch ? parseFloat(volumeMatch[1]) : null;

                    // 验证提取结果
                    if (!weight && !volume) {
                        alert("未识别到有效重量或体积，请检查输入格式！");
                        return;
                    }

                    // 填充到对应输入框
                    if (weight) {
                        document.getElementById('gw').value = weight.toFixed(3);
                    }
                    if (volume) {
                        document.getElementById('volume').value = volume.toFixed(3);
                    }

                    // 提示成功
                    const tips = [];
                    if (weight) tips.push(`重量：${weight}kg`);
                    if (volume) tips.push(`体积：${volume}m³`);
                    alert(`识别成功！\n${tips.join('\n')}`);

                } catch (e) {
                    alert("识别失败：" + e.message);
                }
            }

            // 计费标准切换
            document.addEventListener('DOMContentLoaded', function() {
            const billingRadios = document.querySelectorAll('input[name="billing"]');
            billingRadios.forEach(radio => {
            radio.addEventListener('change', function() {
            const isMainland = this.value === "0.006";
            document.getElementById('mainlandBubble').classList.toggle('hidden', !isMainland);
            document.getElementById('hongkongBubble').classList.toggle('hidden', isMainland);
            });
            });
            });

            // 核心计算逻辑
            function calculate() {
            try {
            const volume = parseFloat(document.getElementById('volume').value) || 0;
            const gw = parseFloat(document.getElementById('gw').value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 6.95;
            const rmbPerKg = parseFloat(document.getElementById('rmbPerKg').value) || 0;

            // 获取计费标准
            const billing = parseFloat(document.querySelector('input[name="billing"]:checked').value) || 0.006;

            // 获取分泡比例
            let bubble = 0;
            if (billing === 0.006) {
            bubble = parseFloat(document.querySelector('input[name="bubble"]:checked').value) || 0.5;
            } else {
            bubble = parseFloat(document.querySelector('input[name="bubbleHk"]:checked').value) || 0.3333;
            }

            // 输入验证
            if (volume <= 0 || gw <= 0 || rmbPerKg <= 0) {
            alert("请填写有效的体积、实际重量和RMB单价（均需大于0）");
            return;
            }

            // 计算逻辑
            const cw = volume / billing;
            document.getElementById('cw').textContent = cw.toFixed(2);

            const ratio = volume > 0 ? gw / volume : 0;
            document.getElementById('ratio').textContent = ratio.toFixed(4);

            const costWeight = gw + (cw - gw) * bubble;
            document.getElementById('costWeight').textContent = costWeight.toFixed(2);

            const costUsdPerKg = exchangeRate > 0 ? rmbPerKg / exchangeRate : 0;
            document.getElementById('usdPerKg').textContent = costUsdPerKg.toFixed(4);

            const totalRMB = costWeight * rmbPerKg;
            const totalUSD = costWeight * costUsdPerKg;
            document.getElementById('totalRMB').textContent = totalRMB.toFixed(2);
            document.getElementById('totalUSD').textContent = totalUSD.toFixed(2);

            const rmbAfter = cw > 0 ? totalRMB / cw : 0;
            document.getElementById('rmbAfter').textContent = rmbAfter.toFixed(4);

            const usdAfter = cw > 0 ? totalUSD / cw : 0;
            document.getElementById('usdAfter').textContent = usdAfter.toFixed(4);

            } catch (e) {
            alert("计算错误: " + e.message);
            }
            }
        </script>
    </body>
</html>
